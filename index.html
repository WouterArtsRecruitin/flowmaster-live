<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowMaster Pro V4 - Recruitment Intelligence Assessment</title>
    
    <!-- PDF Generation Library -->
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            font-weight: 300;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            margin: 30px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.3s ease;
            width: 10%;
        }

        .step {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            text-align: center;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .question-grid {
            display: grid;
            gap: 20px;
            margin: 20px 0;
        }

        .question-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
        }

        .question-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .question-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .radio-option:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .radio-option input[type="radio"] {
            margin-right: 10px;
            width: auto;
        }

        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .button-group {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .secondary-button {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .secondary-button:hover {
            background: #667eea;
            color: white;
        }

        .service-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .service-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .service-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
        }

        .service-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .service-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .service-card .price {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
            margin: 15px 0;
        }

        .service-features {
            list-style: none;
            text-align: left;
            margin-top: 20px;
        }

        .service-features li {
            padding: 5px 0;
            position: relative;
            padding-left: 20px;
        }

        .service-features li:before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
        }

        .results-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 30px 0;
        }

        .score-display {
            font-size: 3em;
            font-weight: 700;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .grade-badge {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: 600;
            margin: 10px;
        }

        .recommendations {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }

        .chat-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .chat-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .privacy-notice {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #e0e0e0;
        }

        .privacy-notice h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin: 20px 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            line-height: 1.4;
        }

        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .success-message {
            color: #27ae60;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .service-cards {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <h1>FlowMaster Pro V4</h1>
                <p>Recruitment Intelligence Assessment</p>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <!-- Step 1: Welcome -->
        <div class="step active" id="step1">
            <h2>Welkom bij FlowMaster Pro V4</h2>
            <p style="text-align: center; font-size: 1.1em; margin: 30px 0;">
                Ontdek de kracht van intelligente recruitment met onze geavanceerde assessment tool. 
                In slechts 10 minuten krijg je een volledig rapport met gepersonaliseerde aanbevelingen.
            </p>
            
            <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin: 30px 0;">
                <h3 style="color: #2c3e50; margin-bottom: 15px;">Wat krijg je:</h3>
                <ul style="list-style: none; padding: 0;">
                    <li style="padding: 8px 0; padding-left: 25px; position: relative;">
                        <span style="position: absolute; left: 0; color: #667eea;">📊</span>
                        Gedetailleerde analyse van je recruitment proces
                    </li>
                    <li style="padding: 8px 0; padding-left: 25px; position: relative;">
                        <span style="position: absolute; left: 0; color: #667eea;">🎯</span>
                        Gepersonaliseerde kandidaat matching
                    </li>
                    <li style="padding: 8px 0; padding-left: 25px; position: relative;">
                        <span style="position: absolute; left: 0; color: #667eea;">📈</span>
                        Optimalisatie voorstellen voor betere resultaten
                    </li>
                    <li style="padding: 8px 0; padding-left: 25px; position: relative;">
                        <span style="position: absolute; left: 0; color: #667eea;">🚀</span>
                        Direct downloadbaar PDF rapport
                    </li>
                </ul>
            </div>

            <div class="button-group">
                <button class="button" onclick="nextStep()">Start Assessment</button>
            </div>
        </div>

        <!-- Step 2: Company Information -->
        <div class="step" id="step2">
            <h2>Bedrijfsinformatie</h2>
            
            <div class="form-group">
                <label for="companyName">Bedrijfsnaam *</label>
                <input type="text" id="companyName" placeholder="Voer je bedrijfsnaam in">
                <div class="error-message" id="companyNameError">Bedrijfsnaam is verplicht</div>
            </div>

            <div class="form-group">
                <label for="contactName">Contactpersoon *</label>
                <input type="text" id="contactName" placeholder="Je voor- en achternaam">
                <div class="error-message" id="contactNameError">Contactpersoon is verplicht</div>
            </div>

            <div class="form-group">
                <label for="companySize">Bedrijfsgrootte</label>
                <select id="companySize">
                    <option value="">Selecteer bedrijfsgrootte</option>
                    <option value="1-10">1-10 medewerkers</option>
                    <option value="11-50">11-50 medewerkers</option>
                    <option value="51-200">51-200 medewerkers</option>
                    <option value="201-500">201-500 medewerkers</option>
                    <option value="500+">500+ medewerkers</option>
                </select>
            </div>

            <div class="button-group">
                <button class="button secondary-button" onclick="previousStep()">Vorige</button>
                <button class="button" onclick="nextStep()" id="step2NextBtn" disabled>Volgende</button>
            </div>
        </div>

        <!-- Step 3: Sector Selection -->
        <div class="step" id="step3">
            <h2>In welke sector ben je actief?</h2>
            
            <div class="form-group">
                <label for="sector">Selecteer je sector</label>
                <select id="sector" onchange="updateSectorQuestions()">
                    <option value="">Kies je sector</option>
                    <option value="techniek_engineering">Techniek & Engineering</option>
                    <option value="bouw_constructie">Bouw & Constructie</option>
                    <option value="installatietechniek">Installatietechniek</option>
                    <option value="metaalbewerking">Metaalbewerking</option>
                    <option value="machinebouw">Machinebouw</option>
                    <option value="hightech_elektronica">High-tech & Elektronica</option>
                    <option value="automotive">Automotive</option>
                    <option value="energie_duurzaamheid">Energie & Duurzaamheid</option>
                </select>
            </div>

            <div class="button-group">
                <button class="button secondary-button" onclick="previousStep()">Vorige</button>
                <button class="button" onclick="nextStep()" id="step3NextBtn" disabled>Volgende</button>
            </div>
        </div>

        <!-- Step 4: General Assessment Questions -->
        <div class="step" id="step4">
            <h2>Algemene Assessment</h2>
            <p style="text-align: center; margin-bottom: 30px; color: #666;">
                Beantwoord de volgende vragen om je recruitment proces te evalueren
            </p>

            <div class="question-grid" id="generalQuestions">
                <!-- Questions will be dynamically generated -->
            </div>

            <div class="button-group">
                <button class="button secondary-button" onclick="previousStep()">Vorige</button>
                <button class="button" onclick="nextStep()" id="step4NextBtn" disabled>Volgende</button>
            </div>
        </div>

        <!-- Step 5: Sector-Specific Questions -->
        <div class="step" id="step5">
            <h2>Sector-specifieke Vragen</h2>
            <p style="text-align: center; margin-bottom: 30px; color: #666;">
                Deze vragen zijn aangepast aan jouw sector
            </p>

            <div class="question-grid" id="sectorQuestions">
                <!-- Questions will be dynamically generated based on sector -->
            </div>

            <div class="button-group">
                <button class="button secondary-button" onclick="previousStep()">Vorige</button>
                <button class="button" onclick="nextStep()" id="step5NextBtn" disabled>Volgende</button>
            </div>
        </div>

        <!-- Step 6: Challenges -->
        <div class="step" id="step6">
            <h2>Wat is je grootste uitdaging?</h2>
            
            <div class="question-card">
                <h3>Selecteer je primaire recruitment uitdaging:</h3>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" name="challenge" value="finding_candidates" id="challenge1">
                        <label for="challenge1">Vinden van gekwalificeerde kandidaten</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="challenge" value="time_to_hire" id="challenge2">
                        <label for="challenge2">Lange doorlooptijd van vacatures</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="challenge" value="quality_candidates" id="challenge3">
                        <label for="challenge3">Kwaliteit van kandidaten</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="challenge" value="retention" id="challenge4">
                        <label for="challenge4">Behoud van nieuwe medewerkers</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="challenge" value="cost_per_hire" id="challenge5">
                        <label for="challenge5">Kosten per aanname</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="challenge" value="employer_branding" id="challenge6">
                        <label for="challenge6">Employer branding en aantrekkelijkheid</label>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button class="button secondary-button" onclick="previousStep()">Vorige</button>
                <button class="button" onclick="nextStep()" id="step6NextBtn" disabled>Volgende</button>
            </div>
        </div>

        <!-- Step 7: Goals -->
        <div class="step" id="step7">
            <h2>Wat wil je bereiken?</h2>
            
            <div class="question-card">
                <h3>Wat is je primaire doel voor de komende 6 maanden?</h3>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" name="goal" value="more_candidates" id="goal1">
                        <label for="goal1">Meer gekwalificeerde kandidaten aantrekken</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="goal" value="faster_hiring" id="goal2">
                        <label for="goal2">Snellere invulling van vacatures</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="goal" value="better_quality" id="goal3">
                        <label for="goal3">Betere kwaliteit van aannames</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="goal" value="reduce_costs" id="goal4">
                        <label for="goal4">Recruitment kosten verlagen</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="goal" value="improve_retention" id="goal5">
                        <label for="goal5">Behoud van nieuwe medewerkers verbeteren</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="goal" value="employer_brand" id="goal6">
                        <label for="goal6">Employer brand versterken</label>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button class="button secondary-button" onclick="previousStep()">Vorige</button>
                <button class="button" onclick="nextStep()" id="step7NextBtn" disabled>Volgende</button>
            </div>
        </div>

        <!-- Step 8: Service Selection -->
        <div class="step" id="step8">
            <h2>Kies je gewenste service</h2>
            
            <div class="service-cards">
                <div class="service-card" onclick="selectService('basic')" id="service-basic">
                    <h3>Basis Assessment</h3>
                    <div class="price">Gratis</div>
                    <p>Perfecte start voor je recruitment analyse</p>
                    <ul class="service-features">
                        <li>Complete assessment analyse</li>
                        <li>PDF rapport met scores</li>
                        <li>Basis aanbevelingen</li>
                        <li>Sector-specifieke tips</li>
                    </ul>
                </div>

                <div class="service-card" onclick="selectService('professional')" id="service-professional">
                    <h3>Professional</h3>
                    <div class="price">€299</div>
                    <p>Voor bedrijven die serieus willen optimaliseren</p>
                    <ul class="service-features">
                        <li>Alles van Basis</li>
                        <li>1-op-1 strategie sessie (60 min)</li>
                        <li>Gedetailleerd actieplan</li>
                        <li>Templates en tools</li>
                        <li>30 dagen email support</li>
                    </ul>
                </div>

                <div class="service-card" onclick="selectService('enterprise')" id="service-enterprise">
                    <h3>Enterprise</h3>
                    <div class="price">€899</div>
                    <p>Complete recruitment transformatie</p>
                    <ul class="service-features">
                        <li>Alles van Professional</li>
                        <li>3 maanden begeleiding</li>
                        <li>Team training sessies</li>
                        <li>Custom recruitment strategy</li>
                        <li>Implementatie ondersteuning</li>
                        <li>Maandelijkse evaluaties</li>
                    </ul>
                </div>
            </div>

            <div class="button-group">
                <button class="button secondary-button" onclick="previousStep()">Vorige</button>
                <button class="button" onclick="nextStep()" id="step8NextBtn" disabled>Volgende</button>  
            </div>
        </div>

        <!-- Step 9: Contact Information -->
        <div class="step" id="step9">
            <h2>Contact informatie</h2>
            
            <div class="form-group">
                <label for="contactEmail">E-mailadres *</label>
                <input type="email" id="contactEmail" placeholder="je.naam@bedrijf.nl">
                <div class="error-message" id="contactEmailError">Geldig e-mailadres is verplicht</div>
            </div>

            <div class="form-group">
                <label for="contactPhone">Telefoonnummer</label>
                <input type="tel" id="contactPhone" placeholder="+31 6 12345678">
            </div>

            <div class="privacy-notice">
                <h3>Privacy en gegevensverwerking</h3>
                <p>Je gegevens worden veilig verwerkt conform de AVG wetgeving. We gebruiken je informatie uitsluitend voor het genereren van je rapport en eventuele vervolgcommunicatie over onze diensten.</p>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="privacyConsent" required>
                    <label for="privacyConsent">
                        Ik ga akkoord met de verwerking van mijn gegevens en het ontvangen van een rapport en vervolgcommunicatie van Recruitin BV. *
                    </label>
                </div>
                <div class="error-message" id="privacyError">Privacy akkoord is verplicht</div>
            </div>

            <div class="button-group">
                <button class="button secondary-button" onclick="previousStep()">Vorige</button>
                <button class="button" onclick="submitForm()" id="submitBtn" disabled>Rapport Genereren</button>
            </div>
        </div>

        <!-- Step 10: Thank You / Results -->
        <div class="step" id="step10">
            <div class="results-summary">
                <h2>🎉 Assessment Voltooid!</h2>
                <p style="font-size: 1.2em; margin: 20px 0;">
                    Bedankt voor het invullen van de FlowMaster Pro V4 assessment. 
                    Je rapport is klaar voor download!
                </p>
            </div>

            <div style="text-align: center; margin: 30px 0;">
                <button class="button" onclick="downloadAssessmentReport()" style="font-size: 18px; padding: 20px 40px;">
                    📊 Download je Rapport
                </button>
            </div>

            <div class="recommendations">
                <h3>Wat gebeurt er nu?</h3>
                <ul style="margin-top: 15px;">
                    <li style="margin: 10px 0;">Je ontvangt binnen 24 uur een gedetailleerd rapport per email</li>
                    <li style="margin: 10px 0;">Wij nemen contact met je op voor een gratis strategiesessie</li>
                    <li style="margin: 10px 0;">Je krijgt toegang tot exclusieve recruitment resources</li>
                </ul>
            </div>

            <div style="text-align: center; margin: 30px 0;">
                <p style="color: #666; font-size: 14px;">
                    Vragen? Bel direct: <strong>+31 614 314 593</strong> of email: <strong>wouter@recruitin.nl</strong>
                </p>
            </div>
        </div>
    </div>

    <!-- Chat Button -->
    <button class="chat-button" onclick="openChat()">
        💬 Chat met ons
    </button>

    <script>
        // Global variables
        let currentStep = 1;
        let formData = {
            companyName: '',
            contactName: '',
            companySize: '',
            sector: '',
            specificSector: '',
            contactEmail: '',
            contactPhone: '',
            privacyConsent: false,
            selectedService: '',
            challenge: '',
            goal: '',
            assessmentAnswers: {},
            sectorAnswers: {},
            totalScore: 0,
            timestamp: new Date().toISOString(),
            assessment_id: 'FM-' + Date.now()
        };

        // Assessment questions
        const generalQuestions = [
            {
                id: 'recruitment_method',
                question: 'Welke recruitment methode gebruik je hoofdzakelijk?',
                options: [
                    { value: 'job_boards', text: 'Online vacaturebanken (Indeed, LinkedIn Jobs)', points: 5 },
                    { value: 'social_media', text: 'Social media recruitment', points: 15 },
                    { value: 'referrals', text: 'Employee referral programma', points: 25 },
                    { value: 'headhunting', text: 'Active sourcing/headhunting', points: 20 },
                    { value: 'recruitment_agency', text: 'Externe recruitment bureaus', points: 10 }
                ]
            },
            {
                id: 'candidate_screening',
                question: 'Hoe screen je kandidaten?',
                options: [
                    { value: 'cv_only', text: 'Alleen CV beoordeling', points: 5 },
                    { value: 'phone_screen', text: 'Telefonische prescreening', points: 15 },
                    { value: 'structured_interview', text: 'Gestructureerde interviews', points: 25 },
                    { value: 'assessment_tests', text: 'Assessment tests en praktijkproeven', points: 30 },
                    { value: 'no_screening', text: 'Geen systematische screening', points: 0 }
                ]
            },
            {
                id: 'employer_branding',
                question: 'Hoe sterk is jullie employer branding?',
                options: [
                    { value: 'very_strong', text: 'Zeer sterk - kandidaten benaderen ons', points: 30 },
                    { value: 'strong', text: 'Sterk - goede reputatie in de markt', points: 25 },
                    { value: 'moderate', text: 'Gemiddeld - sommige activiteiten', points: 15 },
                    { value: 'weak', text: 'Zwak - nauwelijks bezig met employer branding', points: 5 },
                    { value: 'none', text: 'Geen employer branding activiteiten', points: 0 }
                ]
            },
            {
                id: 'time_to_hire',
                question: 'Wat is jullie gemiddelde time-to-hire?',
                options: [
                    { value: 'under_2_weeks', text: 'Minder dan 2 weken', points: 30 },
                    { value: '2_4_weeks', text: '2-4 weken', points: 25 },
                    { value: '1_2_months', text: '1-2 maanden', points: 15 },
                    { value: '2_3_months', text: '2-3 maanden', points: 10 },
                    { value: 'over_3_months', text: 'Meer dan 3 maanden', points: 5 }
                ]
            },
            {
                id: 'candidate_experience',
                question: 'Hoe beoordeel je de candidate experience?',
                options: [
                    { value: 'excellent', text: 'Uitstekend - positieve feedback van kandidaten', points: 30 },
                    { value: 'good', text: 'Goed - meestal tevreden kandidaten', points: 25 },
                    { value: 'average', text: 'Gemiddeld - wisselende feedback', points: 15 },
                    { value: 'poor', text: 'Matig - regelmatig klachten', points: 10 },
                    { value: 'very_poor', text: 'Slecht - veel negatieve feedback', points: 5 }
                ]
            },
            {
                id: 'retention_rate',
                question: 'Wat is jullie retention rate in het eerste jaar?',
                options: [
                    { value: 'over_90', text: 'Meer dan 90%', points: 30 },
                    { value: '80_90', text: '80-90%', points: 25 },
                    { value: '70_80', text: '70-80%', points: 20 },
                    { value: '60_70', text: '60-70%', points: 15 },
                    { value: 'under_60', text: 'Minder dan 60%', points: 10 }
                ]
            },
            {
                id: 'data_tracking',
                question: 'Welke recruitment metrics track je?',
                options: [
                    { value: 'comprehensive', text: 'Uitgebreide analytics (KPIs, ROI, quality of hire)', points: 30 },
                    { value: 'basic_metrics', text: 'Basis metrics (time-to-hire, cost-per-hire)', points: 20 },
                    { value: 'some_tracking', text: 'Beperkte tracking van resultaten', points: 10 },
                    { value: 'no_tracking', text: 'Geen systematische tracking', points: 0 }
                ]
            },
            {
                id: 'technology_usage',
                question: 'Welke recruitment technologie gebruik je?',
                options: [
                    { value: 'advanced_ats', text: 'Geavanceerd ATS met AI en automatisering', points: 30 },
                    { value: 'basic_ats', text: 'Basis ATS systeem', points: 20 },
                    { value: 'crm_tools', text: 'CRM en basis recruitment tools', points: 15 },
                    { value: 'manual_excel', text: 'Hoofdzakelijk Excel en handmatige processen', points: 5 },
                    { value: 'no_tech', text: 'Geen specifieke recruitment technologie', points: 0 }
                ]
            }
        ];

        // Sector-specific questions will be dynamically loaded
        const sectorQuestions = {
            techniek_engineering: [
                {
                    id: 'technical_skills_assessment',
                    question: 'Hoe test je technische vaardigheden?',
                    options: [
                        { value: 'practical_tests', text: 'Praktische technische tests en case studies', points: 30 },
                        { value: 'technical_interviews', text: 'Technische interviews met experts', points: 25 },
                        { value: 'portfolio_review', text: 'Portfolio en projectbeoordeling', points: 20 },
                        { value: 'certification_check', text: 'Alleen certificaten en diploma controle', points: 10 },
                        { value: 'no_testing', text: 'Geen specifieke technische testing', points: 5 }
                    ]
                },
                {
                    id: 'engineering_specialization',
                    question: 'Welke engineering disciplines recruit je voornamelijk?',
                    options: [
                        { value: 'mechanical', text: 'Werktuigbouwkunde', points: 20 },
                        { value: 'electrical', text: 'Elektrotechniek', points: 20 },
                        { value: 'software', text: 'Software engineering', points: 20 },
                        { value: 'civil', text: 'Civiele techniek', points: 20 },
                        { value: 'multiple', text: 'Meerdere disciplines', points: 25 }
                    ]
                },
                {
                    id: 'innovation_focus',
                    question: 'Hoe belangrijk is innovatie in je recruitment?',
                    options: [
                        { value: 'critical', text: 'Kritiek - zoeken naar innovators en disruptors', points: 30 },
                        { value: 'important', text: 'Belangrijk - waarderen creative problem solving', points: 25 },
                        { value: 'moderate', text: 'Gemiddeld - balans tussen ervaring en innovatie', points: 15 },
                        { value: 'traditional', text: 'Traditioneel - focus op bewezen ervaring', points: 10 }
                    ]
                }
            ],
            bouw_constructie: [
                {
                    id: 'safety_priority',
                    question: 'Hoe prioriteer je veiligheid in recruitment?',
                    options: [
                        { value: 'top_priority', text: 'Topprioriteit - uitgebreide veiligheidsscreening', points: 30 },
                        { value: 'important', text: 'Belangrijk - standaard veiligheidschecks', points: 25 },
                        { value: 'standard', text: 'Standaard - basis VCA vereisten', points: 15 },
                        { value: 'minimal', text: 'Minimaal - alleen wettelijke vereisten', points: 10 }
                    ]
                },
                {
                    id: 'project_experience',
                    question: 'Welk type projectervaring zoek je?',
                    options: [
                        { value: 'complex_projects', text: 'Complexe infrastructuurprojecten', points: 30 },
                        { value: 'commercial_construction', text: 'Commerciële bouwprojecten', points: 25 },
                        { value: 'residential', text: 'Woningbouw projecten', points: 20 },
                        { value: 'renovation', text: 'Renovatie en onderhoud', points: 15 },
                        { value: 'all_types', text: 'Alle soorten projecten', points: 20 }
                    ]
                },
                {
                    id: 'sustainability_focus',
                    question: 'Hoe belangrijk is duurzaamheid expertise?',
                    options: [
                        { value: 'essential', text: 'Essentieel - BREEAM/LEED kennis vereist', points: 30 },
                        { value: 'preferred', text: 'Gewenst - groene bouw ervaring is een plus', points: 25 },
                        { value: 'growing', text: 'Groeiend - steeds belangrijker wordend', points: 20 },
                        { value: 'not_priority', text: 'Geen prioriteit - traditionele bouw focus', points: 10 }
                    ]
                }
            ],
            installatietechniek: [
                {
                    id: 'installation_specialization',
                    question: 'Welke installatie specialisaties zijn het belangrijkst?',
                    options: [
                        { value: 'hvac', text: 'HVAC (Heating, Ventilation, Air Conditioning)', points: 25 },
                        { value: 'electrical', text: 'Elektrotechnische installaties', points: 25 },
                        { value: 'plumbing', text: 'Sanitaire installaties', points: 20 },
                        { value: 'smart_systems', text: 'Smart building en domotica', points: 30 },
                        { value: 'all_installations', text: 'Alle installatie disciplines', points: 20 }
                    ]
                },
                {
                    id: 'maintenance_skills',
                    question: 'Hoe belangrijk zijn onderhoudsvaardigheden?',
                    options: [
                        { value: 'critical', text: 'Kritiek - preventief onderhoud expertise', points: 30 },
                        { value: 'important', text: 'Belangrijk - storing oplossen capaciteiten', points: 25 },
                        { value: 'moderate', text: 'Gemiddeld - basis onderhoudskennis', points: 15 },
                        { value: 'installation_focus', text: 'Focus ligt op installatie, niet onderhoud', points: 10 }
                    ]
                },
                {
                    id: 'digital_systems',
                    question: 'Welke digitale systeem kennis zoek je?',
                    options: [
                        { value: 'iot_systems', text: 'IoT en connected building systems', points: 30 },
                        { value: 'building_automation', text: 'Gebouwautomatisering (BMS)', points: 25 },
                        { value: 'traditional_controls', text: 'Traditionele regelsystemen', points: 20 },
                        { value: 'basic_digital', text: 'Basis digitale vaardigheden', points: 15 }
                    ]
                }
            ],
            metaalbewerking: [
                {
                    id: 'metalworking_techniques',
                    question: 'Welke metaalbewerkingstechnieken zijn cruciaal?',
                    options: [
                        { value: 'cnc_machining', text: 'CNC bewerking en programmering', points: 30 },
                        { value: 'welding_advanced', text: 'Geavanceerde lastechnieken (TIG/MIG/robotlassen)', points: 25 },
                        { value: 'sheet_metal', text: 'Plaatbewerking en vormgeving', points: 20 },
                        { value: 'traditional_machining', text: 'Traditionele bewerkingstechnieken', points: 15 },
                        { value: 'all_techniques', text: 'Brede kennis van alle technieken', points: 25 }
                    ]
                },
                {
                    id: 'quality_standards',
                    question: 'Welke kwaliteitsstandaarden zijn belangrijk?',
                    options: [
                        { value: 'iso_advanced', text: 'ISO 9001 + branche specifieke normen', points: 30 },
                        { value: 'iso_basic', text: 'ISO 9001 kwaliteitssystemen', points: 25 },
                        { value: 'industry_standards', text: 'Industrie specifieke standaarden', points: 20 },
                        { value: 'basic_quality', text: 'Basis kwaliteitsbesef', points: 15 }
                    ]
                },
                {
                    id: 'automation_level',
                    question: 'Hoe geautomatiseerd zijn jullie processen?',
                    options: [
                        { value: 'fully_automated', text: 'Volledig geautomatiseerde productie', points: 30 },
                        { value: 'semi_automated', text: 'Semi-geautomatiseerde processen', points: 25 },
                        { value: 'traditional_cnc', text: 'Traditionele CNC bewerking', points: 20 },
                        { value: 'manual_processes', text: 'Voornamelijk handmatige processen', points: 15 }
                    ]
                }
            ],
            machinebouw: [
                {
                    id: 'machine_complexity',
                    question: 'Welk complexiteitsniveau van machines bouw je?',
                    options: [
                        { value: 'high_tech', text: 'High-tech machines met AI en Industry 4.0', points: 30 },
                        { value: 'advanced_automation', text: 'Geavanceerde geautomatiseerde machines', points: 25 },
                        { value: 'standard_industrial', text: 'Standaard industriële machines', points: 20 },
                        { value: 'basic_mechanical', text: 'Basis mechanische systemen', points: 15 }
                    ]
                },
                {
                    id: 'design_capabilities',
                    question: 'Welke design vaardigheden zijn essentieel?',
                    options: [
                        { value: 'advanced_cad', text: 'Geavanceerde CAD/CAM systemen (SolidWorks, Inventor)', points: 30 },
                        { value: 'standard_cad', text: 'Standaard CAD software', points: 25 },
                        { value: 'technical_drawing', text: 'Technisch tekenen en constructie', points: 20 },
                        { value: 'basic_design', text: 'Basis ontwerpvaardigheden', points: 15 }
                    ]
                },
                {
                    id: 'international_experience',
                    question: 'Hoe belangrijk is internationale ervaring?',
                    options: [
                        { value: 'essential', text: 'Essentieel - wereldwijde projecten', points: 30 },
                        { value: 'preferred', text: 'Gewenst - Europese markt focus', points: 25 },
                        { value: 'domestic_focus', text: 'Hoofdzakelijk Nederlandse markt', points: 15 },
                        { value: 'local_only', text: 'Alleen lokale/regionale projecten', points: 10 }
                    ]
                }
            ],
            hightech_elektronica: [
                {
                    id: 'technology_focus',
                    question: 'Welke technologie gebieden zijn jullie focus?',
                    options: [
                        { value: 'semiconductors', text: 'Semiconductor en chip design', points: 30 },
                        { value: 'embedded_systems', text: 'Embedded systems en IoT', points: 25 },
                        { value: 'telecommunications', text: 'Telecommunicatie en netwerken', points: 25 },
                        { value: 'consumer_electronics', text: 'Consumer electronics', points: 20 },
                        { value: 'industrial_electronics', text: 'Industriële elektronica', points: 20 }
                    ]
                },
                {
                    id: 'innovation_speed',
                    question: 'Hoe snel moet personeel zich aanpassen aan nieuwe technologieën?',
                    options: [
                        { value: 'cutting_edge', text: 'Cutting-edge - constant nieuwe technologieën', points: 30 },
                        { value: 'fast_adoption', text: 'Snelle adoptie van nieuwe standaarden', points: 25 },
                        { value: 'steady_evolution', text: 'Geleidelijke technologische evolutie', points: 20 },
                        { value: 'stable_tech', text: 'Stabiele, bewezen technologieën', points: 15 }
                    ]
                },
                {
                    id: 'r_and_d_focus',
                    question: 'Hoe groot is jullie R&D component?',
                    options: [
                        { value: 'primary_focus', text: 'R&D is primaire focus - innovatie gedreven', points: 30 },
                        { value: 'significant_rd', text: 'Significante R&D afdeling', points: 25 },
                        { value: 'some_development', text: 'Beperkte ontwikkelingsactiviteiten', points: 20 },
                        { value: 'production_focus', text: 'Hoofdzakelijk productie/assemblage focus', points: 15 }
                    ]
                }
            ],
            automotive: [
                {
                    id: 'automotive_segment',
                    question: 'In welk automotive segment ben je actief?',
                    options: [
                        { value: 'electric_vehicles', text: 'Elektrische voertuigen en batterijen', points: 30 },
                        { value: 'autonomous_systems', text: 'Autonome rijsystemen en AI', points: 30 },
                        { value: 'traditional_oem', text: 'Traditionele OEM productie', points: 20 },
                        { value: 'aftermarket', text: 'Aftermarket en onderdelen', points: 15 },
                        { value: 'motorsport', text: 'Motorsport en performance', points: 25 }
                    ]
                },
                {
                    id: 'sustainability_automotive',
                    question: 'Hoe belangrijk is duurzaamheid in jullie recruitment?',
                    options: [
                        { value: 'central_theme', text: 'Centraal thema - groene mobiliteit focus', points: 30 },
                        { value: 'important_factor', text: 'Belangrijke factor in alle beslissingen', points: 25 },
                        { value: 'growing_importance', text: 'Groeiend in belang', points: 20 },
                        { value: 'traditional_focus', text: 'Traditionele automotive focus', points: 15 }
                    ]
                },
                {
                    id: 'manufacturing_approach',
                    question: 'Welke manufacturing benadering hanteren jullie?',
                    options: [
                        { value: 'industry_40', text: 'Industry 4.0 - volledig geconnecteerde productie', points: 30 },
                        { value: 'lean_manufacturing', text: 'Lean manufacturing principes', points: 25 },
                        { value: 'traditional_assembly', text: 'Traditionele assemblagelijn productie', points: 20 },
                        { value: 'flexible_manufacturing', text: 'Flexibele productiesystemen', points: 25 }
                    ]
                }
            ],
            energie_duurzaamheid: [
                {
                    id: 'energy_sector_focus',
                    question: 'Welke energie sector is jullie hoofdfocus?',
                    options: [
                        { value: 'renewable_energy', text: 'Hernieuwbare energie (wind, solar, hydro)', points: 30 },
                        { value: 'energy_storage', text: 'Energie opslag en batterij technologie', points: 30 },
                        { value: 'smart_grid', text: 'Smart grid en energie distributie', points: 25 },
                        { value: 'traditional_energy', text: 'Traditionele energie optimalisatie', points: 20 },
                        { value: 'energy_efficiency', text: 'Energie efficiëntie en besparingstechnologie', points: 25 }
                    ]
                },
                {
                    id: 'regulatory_knowledge',
                    question: 'Hoe belangrijk is kennis van energie regulaties?',
                    options: [
                        { value: 'critical', text: 'Kritiek - uitgebreide regulatoire kennis vereist', points: 30 },
                        { value: 'important', text: 'Belangrijk - basis compliance kennis', points: 25 },
                        { value: 'helpful', text: 'Nuttig maar niet essentieel', points: 15 },
                        { value: 'not_required', text: 'Niet vereist - andere rollen', points: 10 }
                    ]
                },
                {
                    id: 'project_scale',
                    question: 'Welke projectschaal hanteren jullie meestal?',
                    options: [
                        { value: 'utility_scale', text: 'Utility-scale projecten (wind/solar parken)', points: 30 },
                        { value: 'commercial_projects', text: 'Commerciële energie projecten', points: 25 },
                        { value: 'residential_solutions', text: 'Residentiële energie oplossingen', points: 20 },
                        { value: 'mixed_scale', text: 'Mix van verschillende project groottes', points: 25 }
                    ]
                }
            ]
        };

        // A/B Testing Configuration
        const abTest = {
            userVariants: {},
            variants: {
                header_copy: ['default', 'urgent', 'benefit_focused'],
                cta_text: ['default', 'action_oriented', 'value_proposition'],
                form_layout: ['single_column', 'multi_step', 'progressive_disclosure']
            },
            
            assignVariant: function(testName) {
                if (!this.userVariants[testName]) {
                    const variants = this.variants[testName];
                    const randomIndex = Math.floor(Math.random() * variants.length);
                    this.userVariants[testName] = variants[randomIndex];
                }
                return this.userVariants[testName];
            }
        };

        // Initialize A/B tests
        function initializeABTests() {
            // Assign variants for this user session
            const headerVariant = abTest.assignVariant('header_copy');
            const ctaVariant = abTest.assignVariant('cta_text');
            const layoutVariant = abTest.assignVariant('form_layout');

            // Apply header variant
            const headerElement = document.querySelector('.header h1');
            switch(headerVariant) {
                case 'urgent':
                    headerElement.textContent = 'FlowMaster Pro V4 - Beperkte Tijd';
                    break;
                case 'benefit_focused':
                    headerElement.textContent = 'FlowMaster Pro V4 - Verhoog je Recruitment ROI';
                    break;
                default:
                    // Keep default text
                    break;
            }

            // Apply CTA variant
            const ctaButtons = document.querySelectorAll('.button');
            ctaButtons.forEach(button => {
                if (button.textContent.includes('Start Assessment')) {
                    switch(ctaVariant) {
                        case 'action_oriented':
                            button.textContent = 'Begin Nu je Assessment';
                            break;
                        case 'value_proposition':
                            button.textContent = 'Ontdek je Recruitment Potentieel';
                            break;
                        default:
                            // Keep default text
                            break;
                    }
                }
            });

            console.log('A/B Test Variants:', abTest.userVariants);
        }

        // Navigation functions
        function nextStep() {
            // Validate current step before proceeding
            if (!validateCurrentStep()) {
                return;
            }

            // Save current step data
            saveCurrentStepData();

            // Hide current step
            hideCurrentStep();

            // Move to next step
            currentStep++;
            
            // Special handling for sector-specific questions
            if (currentStep === 5 && !formData.sector) {
                currentStep = 6; // Skip sector questions if no sector selected
            }

            // Show next step
            showCurrentStep();
            updateProgress();

            // Generate questions if needed
            if (currentStep === 4) {
                generateGeneralQuestions();
            } else if (currentStep === 5) {
                generateSectorQuestions();
            }
        }

        function previousStep() {
            hideCurrentStep();
            currentStep--;
            
            // Special handling for sector-specific questions
            if (currentStep === 5 && !formData.sector) {
                currentStep = 4; // Skip back to general questions if no sector
            }

            showCurrentStep();
            updateProgress();
        }

        function hideCurrentStep() {
            const currentStepElement = document.getElementById(`step${currentStep}`);
            if (currentStepElement) {
                currentStepElement.classList.remove('active');
            }
        }

        function showCurrentStep() {
            const nextStepElement = document.getElementById(`step${currentStep}`);
            if (nextStepElement) {
                nextStepElement.classList.add('active');
            }
        }

        function updateProgress() {
            const progressPercentage = (currentStep / 10) * 100;
            document.getElementById('progressFill').style.width = progressPercentage + '%';
        }

        // Validation functions
        function validateCurrentStep() {
            switch(currentStep) {
                case 2:
                    return validateStep2();
                case 3:
                    return validateStep3();
                case 4:
                    return validateStep4();
                case 5:
                    return validateStep5();
                case 6:
                    return validateStep6();
                case 7:
                    return validateStep7();
                case 8:
                    return validateStep8();
                case 9:
                    return validateStep9();
                default:
                    return true;
            }
        }

        function validateStep2() {
            const companyName = document.getElementById('companyName').value.trim();
            const contactName = document.getElementById('contactName').value.trim();
            
            let isValid = true;

            if (!companyName) {
                showError('companyNameError', 'Bedrijfsnaam is verplicht');
                isValid = false;
            } else {
                hideError('companyNameError');
            }

            if (!contactName) {
                showError('contactNameError', 'Contactpersoon is verplicht');
                isValid = false;
            } else {
                hideError('contactNameError');
            }

            return isValid;
        }

        function validateStep3() {
            const sector = document.getElementById('sector').value;
            return sector !== '';
        }

        function validateStep4() {
            const answeredQuestions = Object.keys(formData.assessmentAnswers).length;
            return answeredQuestions >= generalQuestions.length;
        }

        function validateStep5() {
            if (!formData.sector) return true; // Skip if no sector selected
            const sectorQuestionList = sectorQuestions[formData.sector] || [];
            const answeredQuestions = Object.keys(formData.sectorAnswers).length;
            return answeredQuestions >= sectorQuestionList.length;
        }

        function validateStep6() {
            return document.querySelector('input[name="challenge"]:checked') !== null;
        }

        function validateStep7() {
            return document.querySelector('input[name="goal"]:checked') !== null;
        }

        function validateStep8() {
            return formData.selectedService !== '';
        }

        function validateStep9() {
            const email = document.getElementById('contactEmail').value.trim();
            const privacy = document.getElementById('privacyConsent').checked;
            
            let isValid = true;

            if (!email || !isValidEmail(email)) {
                showError('contactEmailError', 'Geldig e-mailadres is verplicht');
                isValid = false;
            } else {
                hideError('contactEmailError');
            }

            if (!privacy) {
                showError('privacyError', 'Privacy akkoord is verplicht');
                isValid = false;
            } else {
                hideError('privacyError');
            }

            return isValid;
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
            }
        }

        function hideError(elementId) {
            const errorElement = document.getElementById(elementId);
            if (errorElement) {
                errorElement.style.display = 'none';
            }
        }

        // Data saving functions
        function saveCurrentStepData() {
            switch(currentStep) {
                case 2:
                    formData.companyName = document.getElementById('companyName').value.trim();
                    formData.contactName = document.getElementById('contactName').value.trim();
                    formData.companySize = document.getElementById('companySize').value;
                    break;
                case 3:
                    formData.sector = document.getElementById('sector').value;
                    formData.specificSector = formData.sector;
                    break;
                case 6:
                    const challengeElement = document.querySelector('input[name="challenge"]:checked');
                    if (challengeElement) {
                        formData.challenge = challengeElement.value;
                    }
                    break;
                case 7:
                    const goalElement = document.querySelector('input[name="goal"]:checked');
                    if (goalElement) {
                        formData.goal = goalElement.value;
                    }
                    break;
                case 9:
                    formData.contactEmail = document.getElementById('contactEmail').value.trim();
                    formData.contactPhone = document.getElementById('contactPhone').value.trim();
                    formData.privacyConsent = document.getElementById('privacyConsent').checked;
                    break;
            }
        }

        // Question generation functions
        function generateGeneralQuestions() {
            const container = document.getElementById('generalQuestions');
            container.innerHTML = '';

            generalQuestions.forEach(question => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                
                let optionsHtml = '';
                question.options.forEach(option => {
                    optionsHtml += `
                        <div class="radio-option">
                            <input type="radio" name="${question.id}" value="${option.value}" id="${question.id}_${option.value}" onchange="handleGeneralQuestionChange('${question.id}', '${option.value}', ${option.points})">
                            <label for="${question.id}_${option.value}">${option.text}</label>
                        </div>
                    `;
                });

                questionCard.innerHTML = `
                    <h3>${question.question}</h3>
                    <div class="radio-group">
                        ${optionsHtml}
                    </div>
                `;

                container.appendChild(questionCard);
            });
        }

        function generateSectorQuestions() {
            const container = document.getElementById('sectorQuestions');
            container.innerHTML = '';

            const sectorQuestionList = sectorQuestions[formData.sector] || [];
            
            if (sectorQuestionList.length === 0) {
                container.innerHTML = '<p>Geen sector-specifieke vragen beschikbaar.</p>';
                return;
            }

            sectorQuestionList.forEach(question => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                
                let optionsHtml = '';
                question.options.forEach(option => {
                    optionsHtml += `
                        <div class="radio-option">
                            <input type="radio" name="${question.id}" value="${option.value}" id="${question.id}_${option.value}" onchange="handleSectorQuestionChange('${question.id}', '${option.value}', ${option.points})">
                            <label for="${question.id}_${option.value}">${option.text}</label>
                        </div>
                    `;
                });

                questionCard.innerHTML = `
                    <h3>${question.question}</h3>
                    <div class="radio-group">
                        ${optionsHtml}
                    </div>
                `;

                container.appendChild(questionCard);
            });
        }

        // Question handling functions
        function handleGeneralQuestionChange(questionId, value, points) {
            formData.assessmentAnswers[questionId] = {
                value: value,
                points: points
            };
            
            updateStep4Button();
        }

        function handleSectorQuestionChange(questionId, value, points) {
            formData.sectorAnswers[questionId] = {
                value: value,
                points: points
            };
            
            updateStep5Button();
        }

        // Button update functions
        function updateStep2Button() {
            const companyName = document.getElementById('companyName').value.trim();
            const contactName = document.getElementById('contactName').value.trim();
            const button = document.getElementById('step2NextBtn');
            
            if (companyName && contactName) {
                button.disabled = false;
            } else {
                button.disabled = true;
            }
        }

        function updateSectorQuestions() {
            const sector = document.getElementById('sector').value;
            const button = document.getElementById('step3NextBtn');
            
            if (sector) {
                button.disabled = false;
                formData.sector = sector;
                formData.specificSector = sector;
            } else {
                button.disabled = true;
            }
        }

        function updateStep4Button() {
            const answeredQuestions = Object.keys(formData.assessmentAnswers).length;
            const button = document.getElementById('step4NextBtn');
            
            if (answeredQuestions >= generalQuestions.length) {
                button.disabled = false;
            } else {
                button.disabled = true;
            }
        }

        function updateStep5Button() {
            const sectorQuestionList = sectorQuestions[formData.sector] || [];
            const answeredQuestions = Object.keys(formData.sectorAnswers).length;
            const button = document.getElementById('step5NextBtn');
            
            if (answeredQuestions >= sectorQuestionList.length) {
                button.disabled = false;
            } else {
                button.disabled = true;
            }
        }

        function updateSubmitButton() {
            const email = document.getElementById('contactEmail').value.trim();
            const privacy = document.getElementById('privacyConsent').checked;
            const button = document.getElementById('submitBtn');
            
            if (email && isValidEmail(email) && privacy) {
                button.disabled = false;
            } else {
                button.disabled = true;
            }
        }

        // Service selection
        function selectService(serviceType) {
            // Remove selection from all cards
            document.querySelectorAll('.service-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection to clicked card
            document.getElementById(`service-${serviceType}`).classList.add('selected');
            
            // Save selection
            formData.selectedService = serviceType;
            
            // Enable next button
            document.getElementById('step8NextBtn').disabled = false;
        }

        // Challenge and goal selection handlers
        function handlePrivacyChange() {
            const checkbox = document.getElementById('privacyConsent');
            formData.privacyConsent = checkbox.checked;
            updateSubmitButton();
            console.log('Privacy consent:', formData.privacyConsent);
        }

        // Add event listeners for challenge selection
        document.addEventListener('change', function(e) {
            if (e.target.name === 'challenge') {
                formData.challenge = e.target.value;
                document.getElementById('step6NextBtn').disabled = false;
            }
            
            if (e.target.name === 'goal') {
                formData.goal = e.target.value;
                document.getElementById('step7NextBtn').disabled = false;
            }
        });

        // Form submission
        function submitForm() {
            console.log('📝 Starting form submission...');
            
            if (!validateStep9()) {
                console.log('❌ Validation failed');
                return;
            }

            // Save final data
            saveCurrentStepData();

            // Calculate total score
            let totalScore = 0;
            
            // Add points from general questions
            Object.values(formData.assessmentAnswers).forEach(answer => {
                totalScore += answer.points;
            });
            
            // Add points from sector questions
            Object.values(formData.sectorAnswers).forEach(answer => {
                totalScore += answer.points;
            });
            
            formData.totalScore = totalScore;

            console.log('Final form data:', formData);
            
            // Save to session storage for report generation
            sessionStorage.setItem('flowmasterAssessment', JSON.stringify(formData));
            console.log('✅ Data saved to session storage');

            // Prepare data for webhook
            const webhookData = generateWebhookPayload(formData);
            console.log('Webhook payload prepared:', webhookData);

            // Show loading state
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '⏳ Rapport wordt gegenereerd...';
            submitBtn.disabled = true;

            // Submit to webhook
            submitToWebhook(webhookData)
                .then(() => {
                    console.log('✅ Webhook submission successful');
                    // Move to thank you page after short delay
                    setTimeout(() => {
                        try {
                            // Force show bedankpagina (step 10)
                            console.log('Showing step 10 (bedankpagina)');
                            hideCurrentStep();
                            currentStep = 10;
                            showCurrentStep();
                            updateProgress();
                        } catch (error) {
                            console.error('Error in submitForm:', error);
                        }
                    }, 2000);
                })
                .catch(error => {
                    console.error('❌ Webhook submission failed:', error);
                    // Still proceed to thank you page even if webhook fails
                    setTimeout(() => {
                        try {
                            console.log('Proceeding to thank you page despite webhook error');
                            hideCurrentStep();
                            currentStep = 10;
                            showCurrentStep();
                            updateProgress();
                        } catch (error) {
                            console.error('Error showing thank you page:', error);
                        }
                    }, 2000);
                })
                .finally(() => {
                    // Reset button
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                });
        }

        // Webhook submission function
        async function submitToWebhook(data) {
            const webhookUrls = [
                'https://hooks.zapier.com/hooks/catch/19290687/2nskxsx/',
                'https://hook.eu1.make.com/flowmaster-pro-v4',
                'https://hook.eu1.make.com/flowmaster-backup'
            ];

            // Try each webhook URL
            for (let i = 0; i < webhookUrls.length; i++) {
                try {
                    console.log(`Attempting webhook ${i + 1}:`, webhookUrls[i]);
                    
                    const response = await fetch(webhookUrls[i], {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data),
                        mode: 'no-cors'
                    });

                    console.log(`✅ Webhook ${i + 1} submitted successfully`);
                    
                    // Track conversion
                    trackConversion('assessment_completed', formData.selectedService);
                    
                    return; // Success, exit function
                    
                } catch (error) {
                    console.error(`❌ Webhook ${i + 1} failed:`, error);
                    
                    if (i === webhookUrls.length - 1) {
                        // Last webhook failed, store for retry
                        console.log('All webhooks failed, storing for retry...');
                        localStorage.setItem('pendingSubmission', JSON.stringify({
                            data: data,
                            timestamp: new Date().toISOString(),
                            retryCount: 0
                        }));
                        throw error;
                    }
                }
            }
        }

        // Webhook payload generation
        function generateWebhookPayload(data) {
            const leadScore = calculateLeadScore(data);
            const companyMaturity = getMaturityLevel(data.totalScore);
            const leadTags = generateLeadTags(data);
            
            return {
                // Core Assessment Data
                assessment_id: data.assessment_id,
                timestamp: data.timestamp,
                source: 'FlowMaster Pro V4',
                
                // Company Information
                company_name: data.companyName,
                contact_name: data.contactName,
                contact_email: data.contactEmail,
                contact_phone: data.contactPhone,
                company_size: data.companySize,
                sector: data.sector,
                specific_sector: data.specificSector,
                sector_display_name: getSectorDisplayName(data.specificSector),
                
                // Assessment results
                totalScore: data.totalScore,
                companyMaturity: companyMaturity,
                maturityLevel: getMaturityDescription(companyMaturity),
                assessmentAnswers: data.assessmentAnswers,
                sectorAnswers: data.sectorAnswers,
                totalQuestions: 29,
                completionRate: ((Object.keys(data.assessmentAnswers).length + Object.keys(data.sectorAnswers).length) / 29 * 100).toFixed(1),
                
                // Lead qualification
                leadScore: leadScore,
                leadGrade: getLeadGrade(leadScore),
                leadTags: leadTags,
                urgencyLevel: assessUrgencyLevel(data.challenge),
                challenge: data.challenge,
                
                // Service selection
                selectedService: data.selectedService,
                serviceDisplayName: getServiceDisplayName(data.selectedService),
                estimatedValue: getServiceValue(data.selectedService),
                
                // Technical metadata
                userAgent: navigator.userAgent,
                screenResolution: `${screen.width}x${screen.height}`,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                language: navigator.language,
                referrer: document.referrer,
                
                // A/B testing context
                abTestVariants: abTest ? abTest.userVariants : {},
                
                // Follow-up data
                nextActionRecommended: getNextActionRecommendation(leadScore, companyMaturity),
                priorityLevel: getPriorityLevel(leadScore, data.urgencyLevel),
                estimatedCloseDate: getEstimatedCloseDate(leadScore, data.urgencyLevel)
            };
        }
        
        // PipeDrive Integration Functions
        function generatePipeDrivePayload(data) {
            const leadScore = calculateLeadScore(data);
            const companyMaturity = getMaturityLevel(data.totalScore);
            const leadTags = generateLeadTags(data);
            
            return {
                // PipeDrive Configuration
                pipedrive_domain: PIPEDRIVE_CONFIG.domain,
                pipedrive_api_token: PIPEDRIVE_CONFIG.api_token,
                pipeline_id: PIPEDRIVE_CONFIG.pipeline_id,
                stage_id: PIPEDRIVE_CONFIG.default_stage_id,
                
                // Deal Data
                deal_title: `${data.companyName} - FlowMaster Assessment`,
                deal_value: getServiceValue(data.selectedService),
                deal_currency: 'EUR',
                
                // Person Data
                person_name: data.contactName,
                person_email: data.contactEmail,
                person_phone: data.contactPhone,
                
                // Organization Data
                organization_name: data.companyName,
                organization_size: data.companySize,
                
                // Custom Fields
                assessment_score: data.totalScore,
                lead_grade: getLeadGrade(leadScore),
                sector: getSectorDisplayName(data.specificSector),
                service_interest: getServiceDisplayName(data.selectedService),
                urgency_level: assessUrgencyLevel(data.challenge),
                maturity_level: getMaturityDescription(companyMaturity),
                
                // Notes
                deal_notes: `
FlowMaster Pro V4 Assessment Results:
- Assessment Score: ${data.totalScore}/300
- Lead Grade: ${getLeadGrade(leadScore)}
- Company Maturity: ${getMaturityDescription(companyMaturity)}
- Primary Challenge: ${data.challenge}
- Primary Goal: ${data.goal}
- Sector: ${getSectorDisplayName(data.specificSector)}
- Service Interest: ${getServiceDisplayName(data.selectedService)}

Assessment ID: ${data.assessment_id}
Completed: ${new Date(data.timestamp).toLocaleString('nl-NL')}
                `.trim()
            };
        }

        // Google Drive Integration
        function generateGoogleDrivePayload(data) {
            return {
                // File metadata
                fileName: `FlowMaster_Assessment_${data.companyName.replace(/[^a-zA-Z0-9]/g, '_')}_${data.assessment_id}.json`,
                folderId: GOOGLE_DRIVE_CONFIG.folder_id,
                
                // File content
                fileContent: JSON.stringify({
                    ...generateWebhookPayload(data),
                    raw_assessment_data: data
                }, null, 2),
                
                // Sharing settings
                shareWithEmail: 'wouter@recruitin.nl',
                notifyOnUpload: true
            };
        }

        // Utility functions for lead scoring
        function calculateLeadScore(data) {
            let score = 0;
            
            // Base score from assessment
            score += Math.min(data.totalScore, 200); // Max 200 from assessment
            
            // Company size multiplier
            const sizeMultipliers = {
                '1-10': 1.0,
                '11-50': 1.2,
                '51-200': 1.5,
                '201-500': 1.8,
                '500+': 2.0
            };
            score *= (sizeMultipliers[data.companySize] || 1.0);
            
            // Service selection bonus
            const serviceBonus = {
                'basic': 0,
                'professional': 50,
                'enterprise': 100
            };
            score += (serviceBonus[data.selectedService] || 0);
            
            // Urgency bonus
            const urgencyLevels = {
                'finding_candidates': 30,
                'time_to_hire': 25,
                'quality_candidates': 35,
                'retention': 20,
                'cost_per_hire': 15,
                'employer_branding': 10
            };
            score += (urgencyLevels[data.challenge] || 0);
            
            return Math.round(Math.min(score, 300)); // Cap at 300
        }

        function getLeadGrade(score) {
            if (score >= 250) return 'A+';
            if (score >= 200) return 'A';
            if (score >= 175) return 'B+';
            if (score >= 150) return 'B';
            if (score >= 125) return 'C+';
            if (score >= 100) return 'C';
            if (score >= 75) return 'D+';
            return 'D';
        }

        function getMaturityLevel(score) {
            if (score >= 200) return 'Advanced';
            if (score >= 150) return 'Intermediate';
            if (score >= 100) return 'Developing';
            if (score >= 50) return 'Basic';
            return 'Starting';
        }

        function getMaturityDescription(level) {
            const descriptions = {
                'Advanced': 'Geavanceerde recruitment processen met data-driven besluitvorming',
                'Intermediate': 'Gestructureerde recruitment met ruimte voor optimalisatie',
                'Developing': 'Groeiende recruitment capaciteiten met basis processen',
                'Basic': 'Fundamentele recruitment activiteiten aanwezig',
                'Starting': 'Beginnende recruitment organisatie met veel groeipotentieel'
            };
            return descriptions[level] || 'Onbekend niveau';
        }

        function generateLeadTags(data) {
            const tags = [];
            
            // Sector tag
            tags.push(`Sector: ${getSectorDisplayName(data.specificSector)}`);
            
            // Company size tag
            tags.push(`Size: ${data.companySize}`);
            
            // Service interest tag
            tags.push(`Service: ${getServiceDisplayName(data.selectedService)}`);
            
            // Urgency tag
            tags.push(`Challenge: ${data.challenge}`);
            
            // Lead grade tag
            const leadScore = calculateLeadScore(data);
            tags.push(`Grade: ${getLeadGrade(leadScore)}`);
            
            return tags;
        }

        function getSectorDisplayName(sector) {
            const sectorNames = {
                'techniek_engineering': 'Techniek & Engineering',
                'bouw_constructie': 'Bouw & Constructie',
                'installatietechniek': 'Installatietechniek',
                'metaalbewerking': 'Metaalbewerking',
                'machinebouw': 'Machinebouw',
                'hightech_elektronica': 'High-tech & Elektronica',
                'automotive': 'Automotive',
                'energie_duurzaamheid': 'Energie & Duurzaamheid'
            };
            return sectorNames[sector] || 'Onbekende sector';
        }

        function getServiceDisplayName(service) {
            const serviceNames = {
                'basic': 'Basis Assessment',
                'professional': 'Professional Service',
                'enterprise': 'Enterprise Solution'
            };
            return serviceNames[service] || 'Geen service geselecteerd';
        }

        function getServiceValue(service) {
            const serviceValues = {
                'basic': 0,
                'professional': 299,
                'enterprise': 899
            };
            return serviceValues[service] || 0;
        }

        function assessUrgencyLevel(challenge) {
            const urgencyLevels = {
                'finding_candidates': 'High',
                'time_to_hire': 'High',
                'quality_candidates': 'Critical',
                'retention': 'Medium',
                'cost_per_hire': 'Medium',
                'employer_branding': 'Low'
            };
            return urgencyLevels[challenge] || 'Medium';
        }

        function getNextActionRecommendation(leadScore, maturityLevel) {
            if (leadScore >= 200 && maturityLevel === 'Advanced') {
                return 'Strategic consultation - optimize existing processes';
            } else if (leadScore >= 150) {
                return 'Professional assessment - identify key improvement areas';
            } else if (leadScore >= 100) {
                return 'Structured improvement program - build recruitment capabilities';
            } else {
                return 'Foundation building - establish basic recruitment processes';
            }
        }

        function getPriorityLevel(leadScore, urgencyLevel) {
            if (leadScore >= 200 && urgencyLevel === 'Critical') return 'Hot';
            if (leadScore >= 150 && (urgencyLevel === 'High' || urgencyLevel === 'Critical')) return 'Warm';
            if (leadScore >= 100) return 'Qualified';
            return 'Cold';
        }

        function getEstimatedCloseDate(leadScore, urgencyLevel) {
            const baseDate = new Date();
            let daysToAdd = 30; // Default 30 days
            
            if (leadScore >= 200 && urgencyLevel === 'Critical') {
                daysToAdd = 7; // 1 week for hot leads
            } else if (leadScore >= 150) {
                daysToAdd = 14; // 2 weeks for warm leads
            } else if (leadScore >= 100) {
                daysToAdd = 21; // 3 weeks for qualified leads
            }
            
            baseDate.setDate(baseDate.getDate() + daysToAdd);
            return baseDate.toISOString().split('T')[0]; // Return YYYY-MM-DD format
        }

        // Conversion tracking
        function trackConversion(eventName, value = '') {
            // Google Analytics 4
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, {
                    'event_category': 'FlowMaster Assessment',
                    'event_label': value,
                    'value': getServiceValue(value)
                });
            }
            
            // Facebook Pixel
            if (typeof fbq !== 'undefined') {
                fbq('track', 'CompleteRegistration', {
                    content_name: 'FlowMaster Pro V4 Assessment',
                    content_category: 'Recruitment Service',
                    value: getServiceValue(value),
                    currency: 'EUR'
                });
            }
            
            // LinkedIn Insight Tag
            if (typeof lintrk !== 'undefined') {
                lintrk('track', { conversion_id: 12345678 });
            }
            
            // Custom tracking
            console.log(`Conversion tracked: ${eventName} with value ${value}`);
        }
        
        // Retry mechanism for failed webhook submissions
        function retryPendingSubmissions() {
            const pendingData = localStorage.getItem('pendingSubmission');
            if (!pendingData) return;
            
            try {
                const data = JSON.parse(pendingData);
                
                // Check if retry limit reached
                if (data.retryCount >= 3) {
                    console.log('Maximum retry attempts reached, abandoning submission');
                    localStorage.removeItem('pendingSubmission');
                    return;
                }
                
                console.log(`Attempting retry ${data.retryCount + 1} for pending submission...`);
                
                // Update retry data
                data.retryCount++;
                data.lastAttempt = new Date().toISOString();
                
                // Try backup webhook again
                fetch('https://hook.eu1.make.com/flowmaster-backup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        ...data,
                        retryAttempt: true
                    })
                }).then(response => {
                    if (response.ok) {
                        console.log('✅ Retry successful, removing pending submission');
                        localStorage.removeItem('pendingSubmission');
                    } else {
                        throw new Error('Retry failed');
                    }
                }).catch(error => {
                    console.log(`❌ Retry ${data.retryCount} failed:`, error);
                    
                    // Store updated retry data
                    localStorage.setItem('pendingSubmission', JSON.stringify(data));
                    
                    // Schedule next retry with exponential backoff
                    const nextRetryDelay = Math.min(60000 * Math.pow(2, data.retryCount), 300000); // Max 5 minutes
                    setTimeout(() => {
                        retryPendingSubmissions();
                    }, nextRetryDelay);
                });
                
            } catch (error) {
                console.error('Error parsing pending submission data:', error);
                localStorage.removeItem('pendingSubmission');
            }
        }
        
        // Check for pending submissions on page load
        function checkPendingSubmissions() {
            const pendingData = localStorage.getItem('pendingSubmission');
            if (pendingData) {
                console.log('Found pending submission, scheduling retry...');
                setTimeout(() => {
                    retryPendingSubmissions();
                }, 5000); // Wait 5 seconds before first retry
            }
        }

        // Live chat
        function openChat() {
            alert('Chat functionaliteit wordt geladen...\n\nMail ons direct: wouter@recruitin.nl\nBel ons: +31 614 314 593\n\nWouter Arts - Directeur Recruitin BV');
        }

        // Event listeners
        document.getElementById('companyName').addEventListener('input', updateStep2Button);
        document.getElementById('contactName').addEventListener('input', updateStep2Button);
        document.getElementById('contactEmail').addEventListener('input', updateSubmitButton);
        document.getElementById('contactPhone').addEventListener('input', updateSubmitButton);
        document.getElementById('privacyConsent').addEventListener('change', handlePrivacyChange);

        // Initialize
        updateProgress();
        checkPendingSubmissions();

        // PDF Report Generation
        function downloadAssessmentReport() {
            console.log('🔧 PDF Download Debug Started');
            
            // Debug: Check session data
            const sessionData = sessionStorage.getItem('flowmasterAssessment');
            console.log('Session data found:', !!sessionData);
            
            if (sessionData) {
                try {
                    const rawData = JSON.parse(sessionData);
                    console.log('Raw assessment data:', rawData);
                    
                    // Transform data to correct format for PDF generation
                    const assessmentData = {
                        // Core company info
                        companyName: rawData.companyName || formData.companyName || 'Onbekend Bedrijf',
                        contactName: rawData.contactName || formData.contactName || 'Onbekende Contactpersoon',
                        contactEmail: rawData.contactEmail || formData.contactEmail || '',
                        contactPhone: rawData.contactPhone || formData.contactPhone || '',
                        
                        // Scores and assessment results
                        totalScore: rawData.totalScore || formData.totalScore || 0,
                        leadScore: rawData.leadScore || calculateLeadScore(rawData) || 0,
                        leadGrade: rawData.leadGrade || getLeadGrade(rawData.leadScore || calculateLeadScore(rawData)) || 'D',
                        
                        // Sector information
                        specificSector: rawData.specificSector || formData.specificSector || 'unknown',
                        sectorDisplayName: getSectorDisplayName(rawData.specificSector || formData.specificSector),
                        
                        // Company details
                        companySize: rawData.companySize || formData.companySize || 'Onbekend',
                        companyMaturity: getMaturityLevel(rawData.totalScore || formData.totalScore || 0),
                        
                        // Service selection
                        selectedService: rawData.selectedService || formData.selectedService || 'basic',
                        
                        // Timestamps
                        timestamp: rawData.timestamp || new Date().toISOString(),
                        
                        // Assessment metadata
                        assessment_id: rawData.assessment_id || 'FM-' + Date.now(),
                        source: rawData.source || 'FlowMaster Pro V4'
                    };
                    
                    console.log('Processed assessment data for PDF:', assessmentData);
                    
                    // Show download preparation message
                    const downloadBtn = document.querySelector('[onclick="downloadAssessmentReport()"]');
                    const originalContent = downloadBtn.innerHTML;
                    downloadBtn.innerHTML = '⏳ Rapport wordt voorbereid...';
                    downloadBtn.disabled = true;
                    
                    // Generate PDF after short delay
                    setTimeout(() => {
                        try {
                            generateAssessmentReport(assessmentData);
                            console.log('✅ PDF generation completed');
                        } catch (error) {
                            console.error('❌ PDF generation failed:', error);
                            alert('Er is een fout opgetreden bij het genereren van het rapport. Probeer het opnieuw of neem contact met ons op.');
                        } finally {
                            // Reset button
                            downloadBtn.innerHTML = originalContent;
                            downloadBtn.disabled = false;
                        }
                    }, 1000);
                    
                } catch (error) {
                    console.error('Error parsing session data:', error);
                    alert('Er is een probleem met de assessment data. Probeer de assessment opnieuw.');
                }
            } else {
                console.error('No session data found');
                alert('Geen assessment data gevonden. Vul eerst de assessment in.');
            }
        }

        // PDF Generation Function
        function generateAssessmentReport(data) {
            console.log('🔧 Starting PDF generation with data:', data);
            
            // Check if jsPDF is available
            let jsPDFClass;
            if (typeof window.jsPDF !== 'undefined') {
                jsPDFClass = window.jsPDF;
                console.log('✅ jsPDF loaded from window.jsPDF');
            } else if (typeof jsPDF !== 'undefined') {
                jsPDFClass = jsPDF;
                console.log('✅ jsPDF loaded from global jsPDF');
            } else {
                console.error('❌ jsPDF not available');
                alert('PDF library kon niet worden geladen. Probeer de pagina te vernieuwen.');
                return;
            }

            try {
                // Create new PDF document
                const doc = new jsPDFClass();
                const pageWidth = doc.internal.pageSize.width;
                const pageHeight = doc.internal.pageSize.height;
                const margin = 20;
                let yPos = 40;
                
                // Helper function to check if new page is needed
                function checkNewPage(additionalSpace = 20) {
                    if (yPos + additionalSpace > pageHeight - 40) {
                        doc.addPage();
                        yPos = 30;
                    }
                }
                
                // Helper function to add text with automatic line breaks
                function addText(text, fontSize = 12, isBold = false, maxWidth = pageWidth - 2 * margin) {
                    doc.setFontSize(fontSize);
                    doc.setFont('helvetica', isBold ? 'bold' : 'normal');
                    
                    const lines = doc.splitTextToSize(text, maxWidth);
                    
                    for (let i = 0; i < lines.length; i++) {
                        checkNewPage();
                        doc.text(lines[i], margin, yPos);
                        yPos += fontSize * 0.4 + 2;
                    }
                    
                    yPos += 5; // Extra spacing after text block
                }

                // Header
                doc.setFillColor(102, 126, 234);
                doc.rect(0, 0, pageWidth, 30, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(20);
                doc.setFont('helvetica', 'bold');
                doc.text('FlowMaster Pro V4 - Assessment Rapport', margin, 20);
                
                // Reset text color
                doc.setTextColor(0, 0, 0);
                yPos = 45;

                // Company Information Section
                addText('BEDRIJFSINFORMATIE', 16, true);
                addText(`Bedrijf: ${data.companyName}`);
                addText(`Contactpersoon: ${data.contactName}`);
                addText(`E-mail: ${data.contactEmail}`);
                if (data.contactPhone) {
                    addText(`Telefoon: ${data.contactPhone}`);
                }
                addText(`Sector: ${data.sectorDisplayName}`);
                if (data.companySize) {
                    addText(`Bedrijfsgrootte: ${data.companySize}`);
                }
                
                yPos += 10;

                // Assessment Results Section
                addText('ASSESSMENT RESULTATEN', 16, true);
                
                // Score display
                checkNewPage(60);
                doc.setFillColor(240, 248, 255);
                doc.rect(margin, yPos - 5, pageWidth - 2 * margin, 50, 'F');
                
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('Totaal Score:', margin + 10, yPos + 10);
                
                doc.setFontSize(24);
                doc.setTextColor(102, 126, 234);
                doc.text(`${data.totalScore}/300`, margin + 80, yPos + 15);
                
                doc.setFontSize(14);
                doc.setTextColor(0, 0, 0);
                doc.text('Lead Grade:', margin + 10, yPos + 30);
                
                doc.setFontSize(20);
                doc.setTextColor(102, 126, 234);
                doc.text(data.leadGrade, margin + 80, yPos + 35);
                
                doc.setTextColor(0, 0, 0);
                yPos += 60;

                // Maturity Level
                addText(`Recruitment Volwassenheidsniveau: ${data.companyMaturity}`, 12, true);
                addText(getMaturityDescription(data.companyMaturity));
                
                yPos += 10;

                // Recommendations Section
                addText('AANBEVELINGEN', 16, true);
                
                const recommendations = generateRecommendations(data);
                recommendations.forEach(rec => {
                    addText(`• ${rec}`);
                });
                
                yPos += 10;

                // Candidate Matches Section
                addText('KANDIDAAT MATCHES', 16, true);
                addText('Op basis van je sector en assessment score hebben we de volgende kandidaten geïdentificeerd:');
                
                const candidateMatches = generateCandidateMatches(data.specificSector, data.totalScore);
                candidateMatches.forEach((candidate, index) => {
                    checkNewPage(40);
                    
                    addText(`${index + 1}. ${candidate.name} (${candidate.initials})`, 12, true);
                    addText(`Functie: ${candidate.role}`);
                    addText(`Vaardigheden: ${candidate.skills.join(', ')}`);
                    addText(`Match percentage: ${candidate.match}%`);
                    
                    yPos += 5;
                });

                // Next Steps Section
                yPos += 10;
                addText('VERVOLGSTAPPEN', 16, true);
                addText('1. Bel ons voor een gratis strategiesessie: +31 614 314 593');
                addText('2. Plan een uitgebreide recruitment audit');
                addText('3. Implementeer de aanbevolen verbeteringen');
                addText('4. Start met het optimaliseren van je recruitment proces');

                // Footer
                checkNewPage(60);
                yPos = pageHeight - 40;
                
                doc.setDrawColor(102, 126, 234);
                doc.line(margin, yPos, pageWidth - margin, yPos);
                
                yPos += 10;
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text('Recruitin BV | Wouter Arts | wouter@recruitin.nl | +31 614 314 593', margin, yPos);
                doc.text(`Assessment ID: ${data.assessment_id} | Gegenereerd: ${new Date().toLocaleDateString('nl-NL')}`, margin, yPos + 12);

                // Save the PDF
                const fileName = `FlowMaster_Rapport_${data.companyName.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                
                console.log('✅ PDF saved successfully:', fileName);
                
            } catch (error) {
                console.error('❌ PDF generation error:', error);
                throw error;
            }
        }

        // Generate recommendations based on assessment data
        function generateRecommendations(data) {
            const recommendations = [];
            const score = data.totalScore;
            const maturity = data.companyMaturity;
            
            if (score < 100) {
                recommendations.push('Implementeer een gestructureerd recruitment proces met duidelijke stappen');
                recommendations.push('Investeer in employer branding om meer kandidaten aan te trekken');
                recommendations.push('Gebruik moderne recruitment tools en ATS systemen');
            } else if (score < 200) {
                recommendations.push('Optimaliseer je candidate experience om meer kandidaten te converteren');
                recommendations.push('Implementeer data-driven recruitment metrics en KPI tracking');
                recommendations.push('Overweeg employee referral programma\'s voor betere kandidaat kwaliteit');
            } else {
                recommendations.push('Focus op advanced recruitment technologieën zoals AI en automatisering');
                recommendations.push('Ontwikkel strategische talent acquisition voor concurrentievoordeel');
                recommendations.push('Implementeer predictive analytics voor betere hiring beslissingen');
            }
            
            // Sector-specific recommendations
            const sectorRecs = {
                'techniek_engineering': 'Investeer in technische assessment tools en praktijktests',
                'bouw_constructie': 'Focus op veiligheidscertificering en projectervaring screening',
                'installatietechniek': 'Zoek naar kandidaten met smart building en IoT kennis',
                'metaalbewerking': 'Prioriteer CNC programmering en kwaliteitssysteem ervaring',
                'machinebouw': 'Zoek naar internationale ervaring en geavanceerde CAD vaardigheden',
                'hightech_elektronica': 'Focus op R&D ervaring en snelle technologie adaptatie',
                'automotive': 'Investeer in elektrische voertuig en autonome systeem expertise',
                'energie_duurzaamheid': 'Zoek naar hernieuwbare energie en regulatoire kennis'
            };
            
            if (sectorRecs[data.specificSector]) {
                recommendations.push(sectorRecs[data.specificSector]);
            }
            
            return recommendations;
        }

        // Generate candidate matches based on sector and score
        function generateCandidateMatches(sector, totalScore) {
            const qualityBonus = Math.min(totalScore / 10, 20); // Max 20 point bonus for high-scoring companies
            const finalQualityBonus = Math.round(qualityBonus);
            
            const candidates = {
                techniek_engineering: [
                    {
                        name: 'Marco van der Berg',
                        initials: 'MB',
                        role: 'Senior Mechanical Engineer',
                        skills: ['SolidWorks', 'Product Development', 'Project Management', 'Innovation'],
                        match: Math.min(92 + finalQualityBonus, 98)
                    },
                    {
                        name: 'Lisa Hendricks',
                        initials: 'LH',
                        role: 'Electrical Systems Engineer',
                        skills: ['Power Systems', 'Control Systems', 'MATLAB', 'Team Leadership'],
                        match: Math.min(89 + finalQualityBonus, 95)
                    },
                    {
                        name: 'David Koster',
                        initials: 'DK',
                        role: 'Software Engineering Lead',
                        skills: ['Embedded Systems', 'C++', 'Python', 'Agile Development'],
                        match: Math.min(94 + finalQualityBonus, 97)
                    }
                ],
                bouw_constructie: [
                    {
                        name: 'Jeroen van der Meer',
                        initials: 'JM',
                        role: 'Senior Projectleider Bouw',
                        skills: ['Projectmanagement', 'VCA', 'BIM', 'Duurzaam Bouwen'],
                        match: Math.min(92 + finalQualityBonus, 97)
                    },
                    {
                        name: 'Sandra Bakker',
                        initials: 'SB',
                        role: 'Uitvoerder Woningbouw',
                        skills: ['Planning', 'Kwaliteitscontrole', 'Veiligheid', 'Teamleiding'],
                        match: Math.min(89 + finalQualityBonus, 94)
                    },
                    {
                        name: 'Mike de Groot',
                        initials: 'MG',
                        role: 'BIM Coördinator',
                        skills: ['AutoCAD', 'Revit', 'Tekenen', 'Digitale Constructie'],
                        match: Math.min(90 + finalQualityBonus, 95)
                    }
                ],
                installatietechniek: [
                    {
                        name: 'Rob Hendriks',
                        initials: 'RH',
                        role: 'Installatie Engineer W/E',
                        skills: ['Elektrotechniek', 'Klimaatinstallaties', 'PLC', 'Domotica'],
                        match: Math.min(94 + finalQualityBonus, 98)
                    },
                    {
                        name: 'Anita Visser',
                        initials: 'AV',
                        role: 'Service Technicus',
                        skills: ['Onderhoud', 'Troubleshooting', 'Klimaattechniek', 'IoT Systemen'],
                        match: Math.min(91 + finalQualityBonus, 96)
                    },
                    {
                        name: 'Dennis Smits',
                        initials: 'DS',
                        role: 'Projectleider Installaties',
                        skills: ['Projectmanagement', 'Installatieberekeningen', 'Energiebeheersystemen', 'Smart Building'],
                        match: Math.min(88 + finalQualityBonus, 93)
                    }
                ],
                metaalbewerking: [
                    {
                        name: 'Frank van Dijk',
                        initials: 'FD',
                        role: 'CNC Programmeur',
                        skills: ['CNC Programmeren', 'CAM Software', 'Kwaliteitscontrole', 'Lean Manufacturing'],
                        match: Math.min(93 + finalQualityBonus, 97)
                    },
                    {
                        name: 'Patricia Koster',
                        initials: 'PK',
                        role: 'Productie Manager',
                        skills: ['Productieoptimalisatie', 'Six Sigma', 'Teamleiding', 'Proces Verbetering'],
                        match: Math.min(87 + finalQualityBonus, 92)
                    },
                    {
                        name: 'Jan Willems',
                        initials: 'JW',
                        role: 'Lasser/Constructeur',
                        skills: ['TIG/MIG Lassen', 'Constructietekeningen', 'Kwaliteitsborging', 'Robotlassen'],
                        match: Math.min(90 + finalQualityBonus, 95)
                    }
                ],
                machinebouw: [
                    {
                        name: 'Erik Jansen',
                        initials: 'EJ',
                        role: 'Design Engineer',
                        skills: ['SolidWorks', 'Machine Design', 'FEM Analyse', 'Innovatie'],
                        match: Math.min(94 + finalQualityBonus, 98)
                    },
                    {
                        name: 'Marieke van Berg',
                        initials: 'MB',
                        role: 'Commissioning Engineer',
                        skills: ['Inbedrijfstelling', 'Automatisering', 'Klantcontact', 'Internationale Projecten'],
                        match: Math.min(91 + finalQualityBonus, 96)
                    },
                    {
                        name: 'Thomas de Wit',
                        initials: 'TW',
                        role: 'Service Engineer',
                        skills: ['Onderhoud', 'Modificaties', 'Klantservice', 'Technische Documentatie'],
                        match: Math.min(88 + finalQualityBonus, 93)
                    }
                ],
                hightech_elektronica: [
                    {
                        name: 'Dr. Peter Smits',
                        initials: 'PS',
                        role: 'Senior R&D Engineer',
                        skills: ['Semiconductor Design', 'FPGA Development', 'Signal Processing', 'Innovation Management'],
                        match: Math.min(96 + finalQualityBonus, 99)
                    },
                    {
                        name: 'Ingrid van Loon',
                        initials: 'IL',
                        role: 'Embedded Software Architect',
                        skills: ['Real-time Systems', 'IoT Platforms', 'Security', 'Agile Development'],
                        match: Math.min(93 + finalQualityBonus, 97)
                    },
                    {
                        name: 'Kevin Zhou',
                        initials: 'KZ',
                        role: 'Hardware Design Engineer',
                        skills: ['PCB Design', 'Analog Circuits', 'EMC/EMI', 'Product Validation'],
                        match: Math.min(90 + finalQualityBonus, 95)
                    }
                ],
                automotive: [
                    {
                        name: 'Stefan Mueller',
                        initials: 'SM',
                        role: 'Electric Vehicle Engineer',
                        skills: ['Battery Systems', 'EV Architecture', 'Charging Systems', 'Thermal Management'],
                        match: Math.min(95 + finalQualityBonus, 98)
                    },
                    {
                        name: 'Natasha Petrov',
                        initials: 'NP',
                        role: 'Autonomous Systems Developer',
                        skills: ['Computer Vision', 'Machine Learning', 'Sensor Fusion', 'ADAS'],
                        match: Math.min(92 + finalQualityBonus, 96)
                    },
                    {
                        name: 'Carlos Rodriguez',
                        initials: 'CR',
                        role: 'Manufacturing Engineer',
                        skills: ['Industry 4.0', 'Lean Production', 'Quality Systems', 'Process Optimization'],
                        match: Math.min(89 + finalQualityBonus, 94)
                    }
                ],
                energie_duurzaamheid: [
                    {
                        name: 'Dr. Anna van Dijk',
                        initials: 'AD',
                        role: 'Renewable Energy Consultant',
                        skills: ['Wind Energy', 'Solar PV', 'Energy Storage', 'Grid Integration'],
                        match: Math.min(96 + finalQualityBonus, 99)
                    },
                    {
                        name: 'Michiel Bos',
                        initials: 'MB',
                        role: 'Smart Grid Engineer',
                        skills: ['Power Systems', 'Grid Automation', 'Energy Management', 'IoT Integration'],
                        match: Math.min(91 + finalQualityBonus, 96)
                    },
                    {
                        name: 'Sophie Laurent',
                        initials: 'SL',
                        role: 'Sustainability Manager',
                        skills: ['ESG Reporting', 'Carbon Footprint', 'Regulatory Compliance', 'Project Management'],
                        match: Math.min(88 + finalQualityBonus, 93)
                    }
                ]
            };
            
            return candidates[sector] || [
                {
                    name: 'Algemene Kandidaat',
                    initials: 'AK',
                    role: 'Professional',
                    skills: ['Relevante Ervaring', 'Probleemoplossing', 'Teamwork', 'Communicatie'],
                    match: Math.min(75 + finalQualityBonus, 85)
                }
            ];
        }
        
        // Initialize A/B tests on page load
        initializeABTests();
    </script>
</body>
</html>